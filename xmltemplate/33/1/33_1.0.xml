<?xml version="1.0" encoding="UTF-8"?>
<Module>
	<Content view="runtimeEdm">
		<Init>
			<![CDATA[
                (function(){
                    //添加样式
                    if (document.getElementById("auditcss")) {
                        return;
                    }
                    var styles = ".ad-preview {background-color: #FFFFFF; font-family: Tahoma,Verdana,STHeiTi,simsun,sans-serif; padding: 10px; width: 500px;}\n\t\t.ad-preview img{border:1px solid #888;}\n\t\t.ad-preview div{overflow:hidden;margin:auto;}\n\t\t.a-feed1:after {\n\t\t\tclear: both;\n\t\t\tcontent: \" \";\n\t\t\tdisplay: block;\n\t\t}\n\t\t.a-feed1 {\n\t\t\tmargin-left: -20px;\n\t\t\tpadding-left: 20px;\n\t\t}\n\t\t.a-feed1 {\n\t\t\tmargin-bottom: 20px;\n\t\t\tmargin-top: 20px;\n\t\t\tpadding-bottom: 20px;\n\t\t\tposition: relative;\n\t\t\tword-wrap: break-word;\n\t\t}\n\t\t.html5-article, .html5-aside, dialog, .html5-figure, footer, header, hgroup, nav, section, figcaption, details, summary {\n\t\t\tdisplay: block;\n\t\t}\n\t\t.html5-article, .html5-aside, dialog, .html5-figure, footer, header, hgroup, menu, nav, section, time, mark, audio, video, details, summary {\n\t\t\tbackground: none repeat scroll 0 0 transparent;\n\t\t\tborder: 0 none;\n\t\t\tfont-size: 100%;\n\t\t\tmargin: 0;\n\t\t\toutline: 0 none;\n\t\t\tpadding: 0;\n\t\t\tvertical-align: baseline;\n\t\t}\n\t\t.a-feed1 .html5-aside {\n\t\t\tfloat: left;\n\t\t}\n\t\t.a-feed1 .html5-aside .newsfeed-user {\n\t\t\toverflow: visible;\n\t\t\tposition: relative;\n\t\t}\n\t\t.a-feed1 .html5-aside .newsfeed-user a {\n\t\t\theight: 52px;\n\t\t\toverflow: hidden;\n\t\t\twidth: 52px;\n\t\t}\n\t\t/* .feed-module a:link, .feed-module a:hover, .feed-module a:visited {\n\t\t\tcolor: #336699;\n\t\t} */\n\t\t.a-feed1 .html5-aside a, .a-feed1 .html5-aside img {\n\t\t\tdisplay: block;\n\t\t}\n\t\ta:link, a:visited {\n\t\t\tcolor: #336699;\n\t\t\ttext-decoration: none;\n\t\t}\n\t\t.feed-module .a-feed1 img, .feed-module p img {\n\t\t\tmargin: 0;\n\t\t}\n\t\t.a-feed1 .html5-aside a, .a-feed1 .html5-aside img {\n\t\t\tdisplay: block;\n\t\t}\n\t\tfieldset, img {\n\t\t\tborder: 0 none;\n\t\t}\n\t\t.a-feed1 h3.gray {\n\t\t\tcolor: #888888;\n\t\t}\n\t\t.a-feed1 h3 {\n\t\t\tword-wrap: break-word;\n\t\t}\n\t\t.a-feed1 h3 {\n\t\t\tfont-weight: normal;\n\t\t\tline-height: 1.4em;\n\t\t\tmargin-left: 60px;\n\t\t\tmargin-right: 40px;\n\t\t\tpadding-bottom: 5px;\n\t\t}\n\t\th3 {\n\t\t\tfont-size: 14px;\n\t\t}\n\t\t.a-feed1 .feed-toolbar {\n\t\t\tposition: absolute;\n\t\t\tright: 0;\n\t\t\ttop: 0;\n\t\t\tvisibility: hidden;\n\t\t}\n\t\t.a-feed1 .feed-toolbar li {\n\t\t\tfloat: left;\n\t\t\theight: 18px;\n\t\t\tlist-style-type: none;\n\t\t\tmargin-left: 4px;\n\t\t\tposition: relative;\n\t\t\tvertical-align: top;\n\t\t\twidth: 18px;\n\t\t}\n\t\t.a-feed1 .content {\n\t\t\tcolor: #333333;\n\t\t\tline-height: 1.6em;\n\t\t\tmargin-left: 60px;\n\t\t\tmargin-right: 40px;\n\t\t\toverflow: hidden;\n\t\t\tposition: relative;\n\t\t}\n\t\t.a-feed1 .share-source {\n\t\t\tbackground: none repeat scroll 0 0 #F7F7F7;\n\t\t\toverflow: hidden;\n\t\t\tpadding: 8px;\n\t\t}\n\t\t.a-feed1 .share-source .photo {\n\t\t\tbackground: none repeat scroll 0 0 #FFFFFF;\n\t\t\tborder: 1px solid #CEE1EE;\n\t\t\tdisplay: block;\n\t\t\tfloat: left;\n\t\t\tmargin-right: 8px;\n\t\t\tpadding: 4px;\n\t\t\twidth: 100px;\n\t\t}\n\t\t.a-feed1 .share-source .photo:hover {\n\t\t\tborder-color: #005EAC;\n\t\t}\n\t\t/* .a-feed .share-source .photo img {\n\t\t\tdisplay: block;\n\t\t\twidth: 100px;\n\t\t} */\n\t\t.a-feed1 .share-source .description {\n\t\t\tcolor: #888888;\n\t\t\toverflow: hidden;\n\t\t\ttable-layout: fixed;\n\t\t\tword-wrap: break-word;\n\t\t}\n\t\t.a-feed1 .share-source .blog-desc, .a-feed1 .share-source .link-desc {\n\t\t\tcolor: #888888;\n\t\t\toverflow: hidden;\n\t\t\ttable-layout: fixed;\n\t\t\tword-wrap: break-word;\n\t\t}\n\t\t.a-feed1 .share-source .description p.title {\n\t\t\tfont-weight: bold;\n\t\t\tmargin-bottom: 5px;\n\t\t}\n\t\t.a-feed1 .share-source .blog-desc p.title {\n\t\t\tmargin-bottom: 5px;\n\t\t}\n\t\t.a-feed1 .share-source .album {\n\t\t\tbackground: url(\"http://a.xnimg.cn/imgpro/bg/albumcover.png\") no-repeat scroll right bottom transparent;\n\t\t\tdisplay: block;\n\t\t\tfloat: left;\n\t\t\tmargin-right: 8px;\n\t\t\toverflow: hidden;\n\t\t\twidth: 111px;\n\t\t}\n\t\t.a-feed1 .share-source .album span {\n\t\t\tbackground: url(\"http://a.xnimg.cn/imgpro/bg/albumcover.png\") no-repeat scroll left top transparent;\n\t\t\tdisplay: block;\n\t\t\tpadding: 4px 4px 7px;\n\t\t}\n\t\t.a-feed1 .share-source .album img {\n\t\t\tdisplay: block;\n\t\t\twidth: 100px;\n\t\t}\n\t\t.a-feed1 .share-source .description .link-title, .a-feed1 .share-source .description .blog-title, .a-feed1 .share-source .description .video-title {\n\t\t\tfont-weight: bold;\n\t\t}\n\t\t.a-feed1 .share-source .blog-desc .link-title, .a-feed1 .share-source .blog-desc .blog-title, .a-feed1 .share-source .blog-desc .video-title {\n\t\t\tfont-weight: bold;\n\t\t}\n\t\t.a-feed1 .share-source .description .link-description {\n\t\t\tmargin-top: 5px;\n\t\t}\n\t\t.a-feed1 .share-source .blog-desc .link-description {\n\t\t\tmargin-top: 5px;\n\t\t}\n\t\t.a-feed1 .share-source .description .blog-description {\n\t\t\tmargin: 5px 0;\n\t\t}\n\t\t.a-feed1 .share-source .blog-desc .blog-description {\n\t\t\tmargin: 5px 0;\n\t\t}\n\t\t.a-feed1 .details {\n\t\t\tmargin-left: 60px;\n\t\t}\n\t\t.a-feed1 .content em.photo {\n\t\t\tborder: 1px solid #BBC9E2;\n\t\t\tdisplay: inline-block;\n\t\t\tpadding: 3px;\n\t\t\tvertical-align: top;\n\t\t}\n\t\t.a-feed1 .content em.photo img {\n\t\t\tdisplay: block;\n\t\t}\n\t\t.a-feed1 a.delete {\n\t\t\tbackground: url(\"http://a.xnimg.cn/n/core/feed/cssimg/close-button.png\") no-repeat scroll center center transparent;\n\t\t\tdisplay: block;\n\t\t\theight: 18px;\n\t\t\toutline: medium none;\n\t\t\ttext-indent: -9999px;\n\t\t\twidth: 18px;\n\t\t}\n\t\t.feed-replies {\n\t\t\tmargin-right: 30px;\n\t\t\tmargin-top: 13px;\n\t\t}\n\t\t.feed-comment:after {\n\t\t\tclear: both;\n\t\t\tcontent: \" \";\n\t\t\tdisplay: block;\n\t\t}\n\t\t.feed-comment {\n\t\t\tmargin-right: 30px;\n\t\t}\n\t\t.feed-comment .comment-box .action {\n\t\t\tdisplay: none;\n\t\t}\n\t\t.feed-comment .action .emotion {\n\t\t\tbackground: url(\"http://a.xnimg.cn/imgpro/icons/re-icons.png\") no-repeat scroll 0 0 transparent;\n\t\t\tdisplay: block;\n\t\t\tfloat: left;\n\t\t\theight: 14px;\n\t\t\tmargin-right: 20px;\n\t\t\toutline: 0 none;\n\t\t\tposition: relative;\n\t\t\ttext-indent: -9999em;\n\t\t\twidth: 14px;\n\t\t\tz-index: 2;\n\t\t}\n\t\t.feed-comment .avatar {\n\t\t\tdisplay: none;\n\t\t}\n\t\t.feed-module .a-feed1 img, .feed-module p img {\n\t\t\tmargin: 0;\n\t\t}\n\t\t.a-feed1 .details img {\n\t\t\tvertical-align: text-bottom;\n\t\t}\n\t\t.a-feed1 .details #aCreativeGuessYouLike {float: right; margin-right: 40px;}\n\t\t\n\t\t.legend span{color: #636363;}.a-feed1 .legend {padding-top: 15px;}.feed-comment {padding-top: 10px;margin-right: 30px;}.feed-comment textarea {-moz-box-sizing: border-box;background-color: #FFFFFF;border-color: #DDDDDD;color: #888888;display: block;height: 25px;outline: 0 none;resize: none;width: 100%;}";
                    var style = document.createElement("style");
                    style.id = "auditcss";
                    (document.getElementsByTagName("head")[0] || document.body).appendChild(style);
                    if (style.styleSheet) { //for ie
                        style.styleSheet.cssText = styles;
                        style.type = "text/css";
                        style.media = "screen"
                    } else {//for w3c
                        style.appendChild(document.createTextNode(styles));
                    }
                })();


					var init = function(data, adparam, query, isAudit){

						if(data && data != ''){
							//data = eval('(' + data + ')');

							if(data.brandTitle){
							  query.getElementById("aCreativeAdMemberName").innerHTML = data.brandTitle.replace(/ /g,"&nbsp;");
							  query.getElementById("aCreativeAdFrom").innerHTML = data.brandTitle.replace(/ /g,"&nbsp;");
							}

							if(data.addLike){
								if(data.addLike=="1"){
									query.getElementById("aCreativeAddLike").style.display = "inline";
								}
								else{
									query.getElementById("aCreativeAddLike").style.display="none";
								}
							}

							if(data.addShare){
								if(data.addShare=="1"){
									query.getElementById("aCreativeAddShare").style.display = "inline";
								}
								else{
									query.getElementById("aCreativeAddShare").style.display="none";
								}
							}

							if(data.addComment){
								if(data.addComment=="1"){
								query.getElementById("aCreativeAddComment").style.display = "inline";
								}
								else{
									query.getElementById("aCreativeAddComment").style.display="none";
								}
							}

							if(data.addPage){
								if(data.addPage=="1"){
									query.getElementById("aCreativeAddPage").style.display = "inline";
									if(query.getElementById("divPageID")) {
										query.getElementById("divPageID").style.display = "";
									}
									if(query.getElementById("divPageName")) {
										query.getElementById("divPageName").style.display = "";
									}
									if(query.getElementById("divPageUrl")) {
										query.getElementById("divPageUrl").style.display = "";
									}
								}
								else{
									query.getElementById("aCreativeAddPage").style.display="none";
									if(query.getElementById("divPageID")) {
										query.getElementById("divPageID").style.display="none";	
									}
									if(query.getElementById("divPageName")) {
										query.getElementById("divPageName").style.display="none";
									}
									if(query.getElementById("divPageUrl")) {
										query.getElementById("divPageUrl").style.display="none";
									}
								}
							}

							seperatorRebuild();
							if(data.clickUrl){
								var clickUrl = decodeURIComponent(data.clickUrl.replace(/ /g,''));
								query.getElementById("aCreativeTitle").href = clickUrl;
								query.getElementById("aCreativeAdMemberName").href = clickUrl;
								query.getElementById("aCreativeAdFrom").href = clickUrl;
								query.getElementById("aCreativeIcon").parentNode.href = clickUrl;
								query.getElementById("aCreativeText").href = clickUrl;
								query.getElementById("aCreativePic").parentNode.href = clickUrl;
							}

							if(data.title)
								query.getElementById("aCreativeTitle").innerHTML = data.title.replace(/ /g,"&nbsp;");							

							if(data.iconUrl)
								query.getElementById("aCreativeIcon").src = geneMediaUrl(data.iconUrl);

							if(data.text)
								query.getElementById("aCreativeText").innerHTML = data.text.replace(/ /g,"&nbsp;");

							


							if(data.picUrl){
								query.getElementById("aCreativePic").src = geneMediaUrl(data.picUrl);
							}

							if(data.pageName){
								query.getElementById("aCreativePageName").innerHTML = data.pageName.replace(/ /g,"&nbsp;");
							}


						}
					}


				//获得图片、flash等素材的绝对地址
                    var geneMediaUrl = function(raw) {
                        if(!raw){ return ""; }
                        if(raw.indexOf("http://") == -1 && raw.indexOf("https://") == -1) {
                            return 'http://jebe.xnimg.cn' + raw.replace('http://jebe.xnimg.cn', '');
                        }
                        return raw;
                    };




				var seperatorRebuild = function() {
                    var seps, i, parents, seperator;
                    seps = getByClass("seperator");
                    for(i = 0; i < seps.length; i++) {
                        seps[i].style.display = "inline";
                    }

                    parents = new Array(
                        document.getElementById('aCreativeAddShare'),
                        document.getElementById('aCreativeAddLike'),
                        document.getElementById('aCreativeAddPage')
					);
                    for(i in parents) {
                        if(parents[i].style.display != "none") {
                            seperator = parents[i].children[0];
                            seperator.style.display = "none";
                            break;
                        }
                    }
                };



				//按class获取对象
                var getByClass = function(className) {
                    var descendants=document.getElementsByTagName('*'), i=-1, e, result=[];
                    while (e=descendants[++i]) {
                        ((' '+(e['class']||e.className)+' ').indexOf(' '+className+' ') > -1) && result.push(e);
                    }
                    return result;
                }

init(data, data, $)

			]]>
		</Init>
						<![CDATA[
				<style type="text/css">
				.content-box .input-line {
					min-height: 19px;
				}
				.input-line .input-label {
					text-align: right;
					padding-top: 2px;
					width: 82px;
					float: left;
					overflow: hidden;
					clear: both;
				}
				.input-line .input-holder {
					float: left;
					margin-left: 20px;
					margin-right: 10px;
				}
				.s4-input-area {
					float: left;
					overflow: visible;
					width: auto;
				}
				#spanWidget {
					float: left;
					width: 100%;
				}

				.widget-type {
					float: left;
				}
				.widget-type-label {
					margin-left: 11px;
					width: 98px;
					float: left;
				}
				.widget-type label {
					width: 105px;
				}
				.input-line .input-tips {
					width: 331px;
				}
				</style>
				<script type="text/javascript">

					 window.onload = function (){
						//var tClass = '.widget-type';
						//$(tClass).prev().addClass('widget-type-label').parent().css('margin-top', '12px');

						//var tColumn = '#newCampaign .input-tips';
						//$(tColumn).width(185);

						//$(tColumn).find('.input-ad-program-name').before('<input type="hidden" />');
					 }

				</script>
				<div class="ad-preview">
	            <div class="a-feed1 html5-article">
	                <div class="html5-aside">
	                    <div class="newsfeed-user html5-figure">
							<a target="_blank" title="" namecard="" href="http://www.renren.com">
								<img id="aCreativeIcon" width="50" height="50" title="" alt="头像" src="http://static.jebe.renren.com/bolt/img/icon_50_50.jpg">
							</a>
	                    </div>
	                </div>
					<h3 class="gray">
						<a id="aCreativeAdMemberName" stats="" href="http://www.renren.com" namecard="" target="_blank" >“人人网”</a>
						&nbsp;:分享链接
					</h3>
					<div class="content" style="*+margin-left: 0px;">  
						<div class="share-source">
							<em style="border:none;max-height:100px;max-height:100px;" class="photo fix-image-size">
								<a href="#" target="_blank">
									<img id="aCreativePic" src="http://static.jebe.renren.com/bolt/img/pic_100_100.jpg"> 
								</a>
							</em>
						<div class="blog-desc">
							<p style="font-weight:normal" class="link-title">
								<a id="aCreativeTitle" href="http://www.renren.com" target="_blank">加入“人人网”</a>
							</p>   
							<p class="link-url">
								<span class="descript">来自:</span>
								<a id="aCreativeAdFrom" href="http://www.renren.com" target="_blank">人人网</a>
							</p>   
							<p class="link-description">
								<a id="aCreativeText" href="http://www.renren.com" target="_blank"> 
								人人网，中国最真实、最有效的社交平台，加入人人网，找回老朋友，结交新朋友。
								</a>
							</p>
						</div>   
					</div>  
				</div>
		 
				<div class="details">
					<div class="legend"> 
						<span class="duration">刚刚更新</span>
						<span id="aCreativeAddShare">
							<span class="seperator">|</span>
							<a stats="" href="#nogo" class="share_new" data-share="{stype:'create_share_div',id:13391522470,owner:385604396,host:0,ref:'feed',from:'0101010403' }">分享</a>


						</span>
						<span id="aCreativeAddLike" style="display:none;">
							<span class="seperator">|</span>
							<a stats="" href="#nogo" id="" onclick="">喜欢</a>
						</span>
						<span id="aCreativeAddPage" style="display:none">
							<span class="seperator">|</span>
							<a href="#nogo">加<span id="aCreativePageName">人人网</span>为好友</a>
						</span>
						<span id="aCreativeGuessYouLike">人人推广</span>
					</div>
					<div id="" class="feed-replies">
					</div>
					<div class="feed-comment" style="display:none;">
						<span class="avatar">
							<img src="http://a.xnimg.cn/a.gif">
						</span>
						<div class="comment-box">
							<span id="aCreativeAddComment" style="display:inline;">
								<textarea autocomplete="off" data-fid="">评论...</textarea>
							</span>
						</div>
					</div>
				</div>
			</article>
			</div>
			]]>

	</Content>
	<Content view="runtime">
		<Init>
			<![CDATA[
					var init = function(data, adparam, query, isAudit){
						if(isAudit == "1"){
							
							query.getElementById("title").innerHTML = data.title;
							query.getElementById("title").href = ' ' + adparam.click_url;
							query.getElementById("imgClickUrl").href = adparam.click_url;
							var picUrl = adparam.media_uri.indexOf(data.mediaUri) != -1 ? adparam.media_uri : adparam.media_uri + data.mediaUri;
							
							query.getElementById("img").src = picUrl;
							query.getElementById("content").href = ' ' + adparam.click_url;
							query.getElementById("content").innerHTML = data.content.replace(new RegExp('@xn', 'gm'), '&nbsp;&nbsp;');
						
							var liked = false;
							
							if(liked){
								query.getElementById('aZanSmall').innerHTML = "已经喜欢";
								query.getElementById('aZanSmall').onclick = function(){
									likeAd();
								};
							}else{
								query.getElementById('selfzanSmall').innerHTML = "100人";
								query.getElementById('aZanSmall').onclick = function(){
									likeAd();
								};
							}
							
							function likeAd(){    //喜欢或取消喜欢
								if(query.getElementById('aZanSmall').innerHTML == "喜欢"){
									query.getElementById('aZanSmall').innerHTML = "已经喜欢";
									query.getElementById('selfzanSmall').innerHTML = "";
								}else if(query.getElementById('aZanSmall').innerHTML == "取消喜欢"){
									query.getElementById('aZanSmall').innerHTML = "喜欢";
									query.getElementById('selfzanSmall').innerHTML = "100人";
								}
							}
							
							query.getElementById('aZanSmall').onmouseover = function(){
								if(query.getElementById('aZanSmall').innerHTML == "已经喜欢"){
									query.getElementById('aZanSmall').innerHTML = "取消喜欢";
								}
							}
							
							query.getElementById('aZanSmall').onmouseout = function(){
								if(query.getElementById('aZanSmall').innerHTML == "取消喜欢"){
									query.getElementById('aZanSmall').innerHTML = "已经喜欢";
								}
							}
							
							query.getElementById("close").onclick = function(){
								query.getElementById("div_1").style.display = "none";
								query.getElementById("div_2").style.display = "block";
								var options = query.getElementsByName("option");
								for(var i=0; i<options.length; i++){
									if(i == 0){
										options[i].checked = true;
									}else{
										options[i].checked = false;
									}
								}
							}
							
							query.getElementById("reason").onfocus = function(){
								query.getElementById("reason").value = "";
								var options = query.getElementsByName("option");
								for(var i=0; i<options.length; i++){
									if(options[i].checked == true){
										options[i].checked = false;
									}
								}
								options[3].checked = true;
								query.getElementById("reason").style.color = "#333333";
							}
							
							query.getElementById("confirm").onclick = function(){
								query.getElementById("div_2").style.display = "none";
								query.getElementById("div_3").style.display = "block";
							}
							
							query.getElementById("cancel").onclick = function(){
								query.getElementById("div_2").style.display = "none";
								query.getElementById("div_1").style.display = "block";
							}
						}else{
							query.getElementById("title").innerHTML = data.title;
							query.getElementById("title").href = ' ' + adparam.click_url;
							query.getElementById("imgClickUrl").href = adparam.click_url;
							var picUrl = adparam.media_uri.indexOf(data.mediaUri) != -1 ? adparam.media_uri : adparam.media_uri + data.mediaUri;
							query.getElementById("imgClickUrl").innerHTML = "<img src='"+ picUrl +"' />";
							
							query.getElementById("content").href = ' ' + adparam.click_url;
							query.getElementById("content").innerHTML = data.content.replace(new RegExp('@xn', 'gm'), '&nbsp;&nbsp;');    //替换字符
						
							//显示广告信息
							var userID = XN.cookie.get( 'id' );
						
							var liked = false;    //初始化为不喜欢
							/*							
							if(XN.cookie.get('widget_likeAdList')){    //读取cookie列表
							
								var cookieAdList = [];
								var cookieString = XN.cookie.get('widget_likeAdList');
								cookieAdList = cookieString.split(",");
							
								for(var i=0; i<cookieAdList.length; i++){
									if(adparam.creative_id == cookieAdList[i]){
										liked = true;
									}
								}
							}else{
								for(var i=0; i<cookieArray.length; i++){
									if(adparam.creative_id == cookieArray[i]){
										liked = true;
									}
								}
								
							}
							*/							
							
							if(cookieArray.length == 0){    //根据数组长度判断是或否获取全局数组数据
								
								var request = new JebeApi.RestRequests('', '', ''); 
								request.add(JebeApi.ActionRequest.getLikedAds({userID : userID}, 'adlist', false));
								request.send(function(response){
									response = eval('{'+ response.responseText +'}');
									result = response[0].adlist;
									cookieArray = result.split(",");
									cookieArray.push("0");
									
									for(var i=0; i<cookieArray.length; i++){
										if(adparam.creative_id == cookieArray[i]){
											liked = true;
										}
									}
									
									if(liked){
										query.getElementById('aZanSmall').innerHTML = "已经喜欢";
										query.getElementById('selfzanSmall').innerHTML = "";
									}

								}, function(){});
							
							}else if(cookieArray.length == 1){
								liked = false;
							}else{
								for(var i=0; i<cookieArray.length; i++){
									if(adparam.creative_id == cookieArray[i]){
										liked = true;
									}
								}
							}
							
							var engineUrl = adparam.click_url;    //点击的url
							
						
							if(liked){    //已经喜欢过的直接设置喜欢过的显示样式
							
								query.getElementById('aZanSmall').innerHTML = "已经喜欢";
							
								query.getElementById('aZanSmall').onclick = function(){
									
									var likeText = query.getElementById('aZanSmall').innerHTML;
									var logTag = '';
									if(likeText === "取消喜欢") {
										logTag = 'unlikeAd';
									}
									else if(likeText === "喜欢") {
										logTag = 'likeAd';
									}
									
									sendRestLog(logTag,adparam.click_url,adparam.creative_id,adparam.widgetId,adparam.widgetVersion,adparam.adzoneId);
								
									if(query.getElementById('aZanSmall').innerHTML == "取消喜欢"){
										
										var request = new JebeApi.RestRequests(adparam.creative_id, '', '');
										request.add(JebeApi.ActionRequest.getAdLikeCount({creativeID : adparam.creative_id}, 'result', false));
										request.add(JebeApi.ActionRequest.unLikeAd({creativeID : adparam.creative_id, clickUrl : adparam.click_url, absPos : adparam.click_url}, 'result', false));
										request.send(function(response){
												response = eval('{'+ response.responseText +'}');
												var count = parseInt(response[0].result);
												if(count == 0){
													query.getElementById('selfzanSmall').innerHTML = "";
												}else if(count < 6){
													query.getElementById('selfzanSmall').innerHTML = "5人";
												}else{
													query.getElementById('selfzanSmall').innerHTML = count + "人";
												}
											}, function(){});
										
										for(var i=0; i<cookieArray.length; i++){
											if(adparam.creative_id == cookieArray[i]){
												cookieArray[i] = "";
											}	
										}
										var result = cookieArray.join(",");
										//XN.cookie.set("widget_likeAdList", result, 30, "/", "renren.com");
										query.getElementById('aZanSmall').innerHTML = "喜欢";
													
									}else if(query.getElementById('aZanSmall').innerHTML == "喜欢"){
										query.getElementById('aZanSmall').innerHTML = "已经喜欢";
										query.getElementById('selfzanSmall').innerHTML = "";
										var request = new JebeApi.RestRequests(adparam.creative_id, '', '');
										request.add(JebeApi.ActionRequest.likeAd({creativeID : adparam.creative_id, clickUrl : adparam.click_url, absPos : adparam.click_url}, 'result', false));
										request.send(function(response){    //回调函数
												response = eval('{'+ response.responseText +'}');    //response返回值
												
												cookieArray.push(adparam.creative_id);
												var result = cookieArray.join(",");
												
												//XN.cookie.set("widget_likeAdList", result, 30, "/", "renren.com");
											}, function(){});
											
									}
								}
							
							}else{
							
								var request = new JebeApi.RestRequests(adparam.creative_id, '', '');    //没喜欢过的显示喜欢人数
								request.add(JebeApi.ActionRequest.getAdLikeCount({creativeID : adparam.creative_id}, 'result', false));
								
								request.send(function(response){
										response = eval('{'+ response.responseText +'}');		
										var count = parseInt(response[0].result);
										if(query.getElementById('aZanSmall').innerHTML == "喜欢"){
											if(count == 0){
												query.getElementById('selfzanSmall').innerHTML = "";
											}else if(count < 6){
												query.getElementById('selfzanSmall').innerHTML = "5人";
											}else{
												query.getElementById('selfzanSmall').innerHTML = count + "人";
											}
										}
								}, function(){});
								
								query.getElementById('aZanSmall').onclick = function(){    //喜欢或取消喜欢的按钮
								
									var likeText = query.getElementById('aZanSmall').innerHTML;
									var logTag = '';
									if(likeText === "取消喜欢") {
										logTag = 'unlikeAd';
									}
									else if(likeText === "喜欢") {
										logTag = 'likeAd';
									}
									sendRestLog(logTag,adparam.click_url,adparam.creative_id,adparam.widgetId,adparam.widgetVersion,adparam.adzoneId);
									
									if(query.getElementById('aZanSmall').innerHTML == "喜欢"){
										
										var request = new JebeApi.RestRequests(adparam.creative_id, '', '');
										request.add(JebeApi.ActionRequest.likeAd({creativeID : adparam.creative_id, clickUrl : adparam.click_url, absPos : adparam.click_url}, 'result', false));
										request.send(function(response){    //回调函数
												response = eval('{'+ response.responseText +'}');    //response返回值
												query.getElementById('aZanSmall').innerHTML = "已经喜欢";
												query.getElementById('selfzanSmall').innerHTML = "";
											
												cookieArray.push(adparam.creative_id);
												var result = cookieArray.join(",");
											
												//XN.cookie.set("widget_likeAdList", result, 30, "/", "renren.com");
											
											}, function(){});
										
									}else if(query.getElementById('aZanSmall').innerHTML == "取消喜欢"){
										
										var request = new JebeApi.RestRequests(adparam.creative_id, '', '');
										request.add(JebeApi.ActionRequest.getAdLikeCount({creativeID : adparam.creative_id}, 'result', false));
										request.add(JebeApi.ActionRequest.unLikeAd({creativeID : adparam.creative_id, clickUrl : adparam.click_url, absPos : adparam.click_url}, 'result', false));
										request.send(function(response){
												response = eval('{'+ response.responseText +'}');
												var count = parseInt(response[0].result);
												if(count == 0){
													query.getElementById('selfzanSmall').innerHTML = "";
												}else if(count < 6){
													query.getElementById('selfzanSmall').innerHTML = "5人";
												}else{
													query.getElementById('selfzanSmall').innerHTML = count + "人";
												}
											}, function(){});
													
										for(var i=0; i<cookieArray.length; i++){
											if(adparam.creative_id == cookieArray[i]){
												cookieArray[i] = "";
											}
										}
										var result = cookieArray.join(",");
										//XN.cookie.set("widget_likeAdList", result, 30, "/", "renren.com");
										query.getElementById('aZanSmall').innerHTML = "喜欢";	
									}
									
								};
							}
							
							query.getElementById("close").onclick = function(){    //关闭广告按钮							
								
								query.getElementById("div_1").style.display = "none";
								query.getElementById("div_2").style.display = "block";
								
								clearTimeout(XN.jebe.container.nextCheckTimer);

								var options = query.getElementsByName('option');
								for(var i=0; i<options.length; i++){
									if(i == 0){
										options[i].checked = true;
									}else{
										options[i].checked = false;
									}
								}
								query.getElementById("reason").value = "其它";
								query.getElementById("reason").style.color = "#999999";
							}
							
							query.getElementById("reason").onfocus = function(){    //填写关闭原因
								query.getElementById("reason").value = "";
								var options = query.getElementsByName("option");
								for(var i=0; i<options.length; i++){
									if(options[i].checked == true){
										options[i].checked = false;
									}
								}
								options[3].checked = true;
								query.getElementById("reason").style.color = "#333333";
							}
							
							query.getElementById("confirm").onclick = function(){    //调查问卷的确定按钮
								var reasonClose = "";
								var options = query.getElementsByName("option");
								
								XN.jebe.container.nextCheckTimer = setTimeout(function(){
									XN.jebe.container.refreshSpecifyAdzones(null, 0);
									}, XN.jebe.container.nextLoadTime);
								
								for(var i=0; i<options.length; i++){
									if(options[i].checked == true){
										if(i == 3){
											if(query.getElementById("reason").value == ""){
												reasonClose = "其它";
											}else{
												reasonClose = query.getElementById("reason").value;
											}
										}else{
											reasonClose = options[i].value;
										}
									}
								}
								
							
								sendRestLog("closeAd",adparam.click_url,adparam.creative_id,adparam.widgetId,adparam.widgetVersion,adparam.adzoneId,'closeReason',encodeURIComponent(reasonClose));
								
								XN.net.sendStats('http://ebp.renren.com/ebpn/close.html?cid=' + adparam.creative_id);    //使用XN.net.sendStats()方法向引擎发送关闭请求
								
								var request = new JebeApi.RestRequests('adparam.creative_id', '', '');    //向后端接口发送关闭请求
								request.add(JebeApi.ActionRequest.blockAd({creativeID : adparam.creative_id, absPos : adparam.click_url, clickUrl : adparam.click_url, blockReason : encodeURIComponent(reasonClose)}, 'result', false));
								request.send(function(response){response = eval('{'+ response.responseText +'}');}, function(){});
							
								query.getElementById("div_2").style.display = "none";
								query.getElementById("div_3").style.display = "block";
							}
							
							query.getElementById("cancel").onclick = function(){    //调查问卷的取消按钮
								query.getElementById("div_2").style.display = "none";
								query.getElementById("div_1").style.display = "block";
								
								XN.jebe.container.nextCheckTimer = setTimeout(function(){
									XN.jebe.container.refreshSpecifyAdzones(null, 0);
									}, XN.jebe.container.nextLoadTime);
								
							}
							
							query.getElementById('aZanSmall').onmouseover = function(){
								if(query.getElementById('aZanSmall').innerHTML == "已经喜欢"){
									query.getElementById('aZanSmall').innerHTML = "取消喜欢";
								}
							};
							
							query.getElementById('aZanSmall').onmouseout = function(){
								if(query.getElementById('aZanSmall').innerHTML == "取消喜欢"){
									query.getElementById('aZanSmall').innerHTML = "已经喜欢";
								}
							};
							
							query.getElementById("div_1").onmouseover = function(){
								query.getElementById("close").style.display = "block";
							};
							
							query.getElementById("div_1").onmouseout = function(){
								query.getElementById("close").style.display = "none";
							};						

							if(document.getElementById(adparam.widgetRefresh)){
								document.getElementById(adparam.widgetRefresh).onmouseover = function(){
									this.nextSibling.getElementsByTagName("span")[0].style.display = "block";
								};
							}
							
							if(document.getElementById(adparam.widgetRefresh)){
								document.getElementById(adparam.widgetRefresh).onmouseout = function(){
									this.nextSibling.getElementsByTagName("span")[0].style.display = "none";
								};
							}
							
							XN.jebe.addRefreshButtonForNoTitle(adparam);
						}
						
					};init(data, data, $)
					
					
					//包装填写的url
					var geneRealClickUrls = function(url, abflag, adparam, jsonObj, data, noEngineUrl){
					
						if(!url) return "";
					
						if(jsonObj && (jsonObj.tcount || jsonObj.tcount == 0)){
							abflag = abflag+'&statID=ad_' + adparam.adzoneId + '_' + adparam.creative_id + '&level=' + jsonObj.tcount;
						}
					
						if(data && data.socialType && data.socialType ==12 && data.socialId){
							if(url.indexOf('?') >= 0){
								url = url + '&token=' + XN.get_check;
							}else{
								url =  url + '?token=' + XN.get_check;
							}
							url = "http://page.renren.com/api/rd?pid=" + data.socialId + "&url=" + encodeURIComponent(makeUrl(url)); 
						}
					
						if (url.indexOf('?') >= 0) {
							if(abflag !="yuliangdownflash"){
								url = url + '&' + abflag;
							}
						}else{
							if(abflag != "yuliangdownflash"){
								url =  url + '?' + abflag;
							}
						}
						
						if(adparam.click_url != '' && !noEngineUrl){
							return  adparam.click_url +  encodeURIComponent(makeUrl(url));
						}else {
							return makeUrl(url);
						}
					}
					
					//获得图片、flash等素材的绝对地址
					var geneMediaUrl = function(raw) {
                        if(!raw){ return ""; }
                        if(raw.indexOf("http://") == -1 && raw.indexOf("https://") == -1) {
                            return 'http://jebe.xnimg.cn' + raw.replace('http://jebe.xnimg.cn', '');
                        }
                        return raw;
					};

					//对url地址进行处理加上前缀http
					var makeUrl = function (raw) {
						if(!raw) return "";
                        if(raw.indexOf("http://") == -1 && raw.indexOf("https://") == -1) {
							raw = 'http://' + raw;
						}
						return raw;
					};
					
					//对数字加逗号
					function commaSplit(srcNumber){
						var txtNumber = '' + srcNumber;
						if(isNaN(txtNumber) || txtNumber == ""){
							return srcNumber;
						}else{
							var rxSplit = new RegExp('([0-9])([0-9][0-9][0-9][,.])');
							var arrNumber = txtNumber.split('.');
							arrNumber[0] += '.';
							do{
								arrNumber[0] = arrNumber[0].replace(rxSplit, '$1, $2');
							}while(rxSplit.test(arrNumber[0]));
							
							if(arrNumber.length > 1){
								return arrNumber.join('');
							}else{
								return arrNumber[0].split('.')[0];
							}
						}
					}

					//发送统计信息
					var sendLog = function(engineUrl, abflag, clickUrl, refresh_source, refresh_idx){
						engineUrl = encodeURIComponent(engineUrl + clickUrl);
						var userid=XN.cookie.get('id');
						var loc = encodeURIComponent(window.location.href);
						var param = '&url=' + engineUrl + '&abflag=' + abflag + '&userid=' + userid + '&location=' + loc;
						
						if(refresh_source){param = param + '&source=' + refresh_source;}
	
						if(refresh_idx){param = param + '&idx=' + refresh_idx;}
	
						new XN.net.xmlhttp({
							url: "http://rest.widgetbox.jebe.renren.com/widgetboxs/rest/log",
							method: 'post',
							data: '&url=' + engineUrl + '&abflag=' + abflag + '&userid=' + userid + '&location=' + loc,
							onSuccess: function(){},
							onError: function(){}
						});
					}
					
					var sendRestLog = function(log_tag,clickUrl,creative_id,widget_id, widget_version,adzone_id,customName,customValue) {
					
						var clickUrl = encodeURIComponent(clickUrl);
						
						var userid = XN.cookie.get('id');
						var loc = encodeURIComponent(window.location.href);
						
						var time = new Date().valueOf();
						var param =  '&log_tag=' + log_tag + '&url=' + clickUrl + '&adzone_id=' + adzone_id + '&creative_id=' + creative_id + '&member_id=' + userid + '&location=' + loc + '&widget_id=' + widget_id + '&widget_version=' + widget_version + '&time=' + time;
						if(typeof customName != "undefined" && customName != "") {
							param += '&' + customName + '=' + customValue;
						}
						
						console.log("sendRestLog,param=" + param);
						
						new XN.net.xmlhttp({
							url: "http://rest.widgetbox.jebe.renren.com/widgetboxs/rest/widget",
							method: 'post',
							data: param,
							onSuccess: function(){},
							onError: function(){}
						});
						
					}
				
					//统计social信息的接口
					var dealUserClick = function(ele, engineUrl, abflag){
						for(var m=ele.firstChild; m!=null; m=m.nextSibling){
							if(m.nodeType == 1 && (m.tagName== 'A'|| m.tagName== 'a')){
								m.onclick = function(){
									sendLog(engineUrl, abflag, this.href);
								}
							}
						}
					}

					var dealName = function(name, id, pic, sgType){
						if(name.length > 3){name=name.substr(0,3);}
						if(sgType == 1){name = "<a href='http://www.renren.com/profile.do?id="+id+"' target='_blank'>"+name+"</a>&nbsp;";}
						if(sgType == 2){name = "<a href='http://www.renren.com/profile.do?id="+id+"' class='userPic' target='_blank'><img  width='25' height='25' vspace='5'  src='"+pic+"' alt='"+name+"' title='"+name+"'/></a>&nbsp;";}
						return name;
					};

					var dealFriend =  function(friends, zaned, sgType){
						var result = ''
						for(var i=0; i<friends.length; i++){
							result += dealName(friends[i].name,friends[i].userID,friends[i].pic,sgType);
						}
						/*
						if(zaned)
						result = '&nbsp;'+result    
						*/
						return result;
					}
	
			]]>
		</Init>
			
			<![CDATA[
					<div class="ad-contrainer" style="padding:0px;">
                		<div id="div_1" class="ad-show-box">
							<h4 class="header" style="padding:0px 0px 6px 0px; margin:0px 0px 0px 0px; border-top:none;"><a id="title" href="#" target="_blank"></a><span id="close" class="close-btn"></span></h4>
							<div style="width:105px; float:left; padding:0px;">
								<a id="imgClickUrl" class="img" href="#" target="_blank">
									<img id="img" style="margin-left:0px" src="" />
								</a>
							</div>
							<p class="discribe"><a id="content" class="ad-content" href="#" target="_blank" style="padding-top:0px; text-decoration:none; cursor:pointer; outline:0 none;" hidefocus="true"></a></p>
							<div style="padding:0px; margin:0px; text-align:left; clear:both; width:240px;">
								<div class="footer">
								
									<a id="aZanSmall" class="like-ad" href="javascript:;">喜欢</a>
									
									<span id="selfzanSmall" style="color:#888888; padding:0px 0px 0px 5px"></span>
								
								</div>
							</div>
                		</div>
						
						<div id="div_2" class="ad-close" style="display:none; padding-left:3px;">
							<h4 style="padding:0px 0px 6px 0px;">我们将尽量不再向你展示此广告</h4>
							<div style="padding:2px 0px 2px 0px">为什么不喜欢此广告？</div>
							<div style="padding:2px 0px 2px 0px"><input type="radio" name="option" value="我对这条广告不感兴趣" checked /> 我对这条广告不感兴趣</div>
							<div style="padding:2px 0px 2px 0px"><input type="radio" name="option" value="担心广告误导我" /> 担心广告误导我</div>
							<div style="padding:2px 0px 2px 0px"><input type="radio" name="option" value="已看过这条广告" /> 已看过这条广告</div>
							<div style="padding:2px 0px 2px 0px"><input type="radio" name="option" value="其它" /> <input id="reason" class="close-reason" type="text" maxlength="20" value="其它" /></div>
							<div style="padding:7px 0px 3px 20px; *padding:7px 0px 3px 24px;">
								<input id="confirm" class="ad-confirm-btn" style="margin:2px 0px 5px 0px;" type="button" value="确定" />
								<input id="cancel" class="ad-cancel-btn" style="margin:2px 0px 5px 0px;" type="button" value="取消" />
							</div>
						</div>
					
						<div id="div_3" class="thank-slogan" style="display:none; padding:10px">
							<div class="thanks">感谢您的反馈，<br />我们将努力提供更多您喜欢的广告！</div>
						</div>
					</div>
			]]>
	</Content>
	
	<Content view="setting">
		<Init>
			<![CDATA[
					var init = function(data, query){
                    	setHiddenImageWidthAndHeight(100, 75);						
						$('#titleEdit').rules('remove');
						$('#titleEdit').rules('add', {required:true, minLengthCC:2, maxLengthCC:24, messages:{required:'请输入广告的标题', minLengthCC:'标题不能少于1个汉字(即2个数字或字母)', maxLengthCC:'您的标题过长，不能超过12个汉字(即24个数字或字母)'}});
						 $('#text').rules('remove');
           				 $('#text').rules('add',{required:true, minLengthCC:2,maxLengthCC:80,messages:{required:'请输入描述',maxLengthCC:'描述不能超过40个汉字(即80个数字或字母)'}});                    	
						if(data && data != ''){
                        	//changePrice(100, 75, true);
                        	data = eval('(' + data + ')');
							
							
							query.getElementById("clickUrl").value = data.clickUrl;
							query.getElementById("titleEdit").value = data.title;
							calcTitleInputRemain();
							
							
							if(data.content){
    							query.getElementById("text").value = data.content.replace(new RegExp('@xn','gm'), '  ');
    							calcContentInputRemain();
							}
							
							
							if(data.mediaUri){
    							query.getElementById("mediaUri").value = data.mediaUri;
    							$("#divRemoveUploadedFile").show();
    							$("#mediaUri").parents(".input-line:eq(0)").removeClass("error");
    							$("#mediaUri").parents(".input-holder:eq(0)").siblings(".input-tips-error").remove();
    							$("#mediaUri").parents(".input-holder:eq(0)").siblings(".input-tips").show();
    							$("#picsize").attr("disabled","disabled");
    							$("#creativePic").hide();
							}
							
							preview(data);
						}
						
						$('#show_place_info').html('首页，日志页，相册页，视频页，好友列表页，游戏页');
						
					}
					
					createData = function(){
                    	var result = {};
						
						
						result.title = $('#titleEdit').val();
						result.clickUrl = $('#clickUrl').val();
						
						
						result.content = $.trim($('#text').val()).replace(new RegExp('\n','gm'), '@xn');
						
						
						result.mediaUri = $('#mediaUri').val();
						
                    	$('#widget').val(obj2str(result));
                	}
					
                	preview = function(data){
                    	if(data && typeof(data) == 'string' && data != '')
                        data = eval('(' + data + ')');
						
						
						$('#aCreativeTitle').attr('href', makeUrl(data.clickUrl.replace(/ /g, '')));  
						$('#aCreativeTitle').html(data.title.replace(/ /g, "&nbsp;"));
						
						
						$('#aCreativeUrl').attr('href', makeUrl(data.clickUrl.replace(/ /g, '')));
    					$('#divCreativeContent').attr('href', makeUrl(data.clickUrl.replace(/ /g, '')));
    					$('#divCreativeContent').html(data.content.replace(new RegExp('@xn','gm'), '&nbsp;&nbsp;'));
						
						
						if(data.mediaUri){
							$('#aCreativeUrl').attr('href', makeUrl(data.clickUrl.replace(/ /g,'')));  
							$('#imgCreativePic').attr('src', geneMediaUrl(data.mediaUri));
						}
						
                	}
					
					
					var geneMediaUrl = function(raw){
    					if(raw)
        					return 'http://jebe.xnimg.cn' + raw.replace('http://jebe.xnimg.cn', '');
    					else
        					return '';
					};

					var makeUrl = function(raw){
						if(!raw) return "";
                        if(raw.indexOf("http://") == -1 && raw.indexOf("https://") == -1) {
							raw = 'http://' + raw;
						}
						return raw;
					};
					
					
					onEditCreativeTitle = function(){
    					replaceTitleInvalidChar();
    					$("#aCreativeTitle").html($("#titleEdit").val().replace(/ /g, "&nbsp;"));
    					calcTitleInputRemain();
					}

					calcTitleInputRemain = function(){
    					var avail = 24 - $.trim($("#titleEdit").val()).getBytes();
    					avail = avail > 0 ? avail : 0;
    					$("#spTitleRemainWords").text(parseInt(avail/2));
					}
					
					onEditCreativeUrl = function(){
    					var value = $.trim($("#clickUrl").val());
    					if(value && !(value.indexOf("http://") != -1 || value.indexOf("https://") != -1)){
        					value = "http://" + value;
    					}
    					$('#aCreativeTitle,#aCreativeUrl,#divCreativeContent').attr('href', value);
					}

					replaceTitleInvalidChar = function(){
    					var title = $("#titleEdit").val();
    					var reg = new RegExp("[\\r]+", "gm");
    					if (title.search(reg) != -1) {
        					title = title.replace(reg, "");
        					$("#titleEdit").val(title);
    					}
					}
					
					
					onEditCreativeContent = function(){
						replaceContentInvalidChar();
						$("#divCreativeContent").html($("#text").val().replace(new RegExp('\n', 'gm'), '&nbsp;&nbsp;'));
						$("#divCreativeContent").attr('href',makeUrl($("#clickUrl").val().replace(/ /g, '')));
						calcContentInputRemain();
					}

					calcContentInputRemain = function(){
    					var avail = 80 - $.trim($("#text").val()).getBytes();
    					avail = avail > 0 ? avail : 0;
						$("#spContentRemainWords").text(parseInt(avail/2));
					}

					replaceContentInvalidChar = function(){
    					var content = $("#text").val();
    					var reg = new RegExp("[\\r]+","gm");
    					if(content.search(reg) != -1){
        					content = content.replace(reg,"");
        					$("#text").val(content);
        					$("#text").text(content);
    					}
					}
					
					
					//上传和删除广告图片
					gwidth=0;
					gheight=0;
					
					uploadCreative = function(width, height) {
						$("#bigPic").after("<iframe name='selfhelpIframe' id='selfhelpIframe' style='display:none' src='http://bolt.jebe.renren.com/ajaxproxy.htm'></iframe>");
						if(width && height){
							gwidth=width;
							gheight=height;
						}
						$("#creativePic").hide();
						$("#divRemoveUploadedFile").hide();
						$("#imgCreativePic").removeAttr("src");
						$("#mediaUri").val("");
						$("#divErrorInfo").hide();
						$("#divErrorInfo").text("");
						$("#divImgUploadProgress").show();
						$.ajaxFileUpload
						(
							{
							url : '/bolt/creative/uploadCreative.htm?adzoneID=' + $("[name=adzoneID]").val() + '&width=' + gwidth + '&height=' + gheight,
							secureuri : false,
							fileElementId : 'creativePic',
							dataType : 'json',
							success : function (data, status){
								if (data.result == 1) {
									$("#imgCreativePic").attr("src", IMAGE_DOMAIN + data.mediaUrl);
									$("#mediaUri").val(data.mediaUrl);
									$("#divImgUploadProgress").hide();
									$("#creativePic").replaceWith("<input class='ad-upload-button' id='creativePic' name='creativePic' type='file' value='上传' onchange='uploadCreative("+gwidth+", "+gheight+");' size='10'>");
									$("#divRemoveUploadedFile").show();
									$("#mediaUri").parents(".input-line:eq(0)").removeClass("error");
									$("#mediaUri").parents(".input-holder:eq(0)").siblings(".input-tips-error").remove();
									$("#mediaUri").parents(".input-holder:eq(0)").siblings(".input-tips").show();
									$("#creativePic").hide();
                
								}else{
									$("#creativePic").replaceWith("<input class='ad-upload-button' id='creativePic' name='creativePic' type='file' value='上传' onchange='uploadCreative("+gwidth+", "+gheight+");' size='10'>");
									$("#divImgUploadProgress").hide();
									$("#divErrorInfo").text(data.error);
									$("#divErrorInfo").show();
									$("#selfhelpIframe").remove();
								}
							},
							error : function (data, status, e){
								$("#creativePic").replaceWith("<input class='ad-upload-button' id='creativePic' name='creativePic' type='file' value='上传' onchange='uploadCreative();' size='10'>");
								$("#divImgUploadProgress").hide();
								$("#creativePic").replaceWith("<input class='ad-upload-button' id='creativePic' name='creativePic' type='file' value='上传' onchange='uploadCreative();' size='10'>");
								if(data){
									if (data && data.responseText && data.responseText.indexOf("MaxUploadSizeExceededException") != -1) {
										$("#divErrorInfo").text("图片过大，不能超过3M");
									}else{
										$("#divErrorInfo").text("操作失败，可能网络不稳定，请稍后重试！");
									}
                				}
								$("#divErrorInfo").show();
							}
							},'selfhelpIframe'
						)
					}
					
					removeUploadedFile = function (width, height){
						$.getJSON(BOLT_DOMAIN + "/bolt/creative/removeUploadedFile.htm", { "mediaUri": $("#mediaUri").val()},
						function(data){
							if (data.result == 1) {
								$("#divRemoveUploadedFile").hide();
								$("#imgCreativePic").removeAttr("src");
								$("#mediaUri").val("");
								if(width >75){
									$("#imgCreativePic").attr("src","STATIC_DOMAIN/img/example-pic-220.jpg");
								}else{
									$("#imgCreativePic").attr("src","STATIC_DOMAIN/img/example-pic100x75.jpg");
								}
								$("#creativePic").show();
							}else{
								$("#divErrorInfo").text("删除已上传图片失败");
								$("#divErrorInfo").show();
							}
						});
						
						$("#selfhelpIframe").remove();
					}
					
			]]>
		</Init>
			
			<![CDATA[
					<!--<div class="input-line clearfix">
                        <div class="inline-input-holder">
                            <input id="commonAD" name="adType" type="radio" value="0" onclick="adTypeSelect()"/>
                            <label class="check-box-holder" for="commonAD">普通广告</label>
                            <input id="newAD" name="adType" type="radio" value="1" onclick="adTypeSelect()"/>
                            <label class="check-box-holder" for="newAD">新广告</label>
                            <input type="hidden" id="adTypeSelected" />
                        </div>
                    </div>-->
					
					
					<div class="input-line clearfix">
						<div class="input-label">
							<label>链接地址: </label>
						</div>
						<div class="input-holder">
							<input class="input-url" id="clickUrl" name="clickUrl" type="text" value="" onblur="onEditCreativeUrl()" onkeyup="onEditCreativeUrl()" validate="{required:true, maxlength:1024, messages:{required:'请输入链接地址', maxlength:'您的链接过长，不能超过1024个字母'}}" />
						</div>
						<div class="input-tips">比如 http://www.renren.com</div>
					</div>
					<div id= "titleEditDiv" class="input-line clearfix">
						<div class="input-label">
							<label>广告标题: </label>
						</div>
						<div class="input-holder">
							<input class="input-ad-title" id="titleEdit" name="titleEdit" type="text" value="" onblur="onEditCreativeTitle()" onkeyup="onEditCreativeTitle()" validate="{required:true, minLengthCC:2, maxLengthCC:24, messages:{required:'请输入广告的标题', minLengthCC:'标题不能少于1个汉字(即2个数字或字母)', maxLengthCC:'您的标题过长，不能超过12个汉字(即24个数字或字母)'}}" />
						</div>
						<div class="input-tips">您还有<span id="spTitleRemainWords">12</span>个汉字可填</div>
					</div>
					
					
					<div class="input-line clearfix">
						<div class="input-label">
							<label>推荐语: </label>
						</div>
						<div class="input-holder">
							<textarea class="input-ad-content-text" style="resize:none" id="text" name="text" cols="20" rows="2" onblur="onEditCreativeContent()" onkeyup="onEditCreativeContent()" validate="{required:true, maxLengthCC:80, isThereMoreThan5Enter:true, messages:{required:'请输入产品的推荐语', maxLengthCC:'您的推荐语过长，不能超过40个汉字(即80个数字或字母)', isThereMoreThan5Enter:'推荐语最多支持５个回车,您不能再使用回车了'}}"></textarea>
						</div>
						<div class="input-tips">您还有<span id="spContentRemainWords">40</span>个汉字可填</div>
						<input type="hidden" name="validateContent" value="true" />
					</div>
					
					
					<div class="input-line clearfix">
						<input type="hidden" name="validateMediaUri" value="true" />
						<div class="input-label">
							<label>图片: </label>
						</div>
						<div class="input-holder">
							<input id="mediaUri" name="mediaUri" type="hidden" value="" validate="{required:true,messages:{required:'请上传广告图片'}}" />
							<input class="ad-upload-button" id="creativePic" name="creativePic" type="file" value="上传" onchange="uploadCreative('100','75');" size="10" />
							<div class="pic-upload hide" id="divImgUploadProgress">
								<div class="loading-s">
									<img src="STATIC_DOMAIN/img/loading-s.gif" />&nbsp;&nbsp;正在上传中...
								</div>
							</div>
							<div class="pic-upload hide" id="divRemoveUploadedFile" >图片上传成功，若需删除请<a href="javascript:void(0)" onclick="removeUploadedFile('${width}','${height}')">点此</a>。</div>
							<div class="pic-upload text-red hide" id="divErrorInfo"></div>
						</div>
						<div class="input-tips" id="sizecontent">图片将自动被调整为100*75像素，支持JPG/PNG格式</div>
					</div>

					<div class="input-line clearfix" id="bigPic" style="display:none">
						<div class="input-label">
							<label>大图片: </label>
						</div>
						<div class="input-holder">
							<input id="bigMediaUri" name="bigMediaUri" type="hidden" value="" />
							<input id="gifFrames" name="gifFrames" type="hidden" value="" />
							<input class="ad-upload-button" id="creativePicBig" name="creativePicBig" type="file" value="上传" onchange="uploadGifBig();" size="10">
							<div class="pic-upload hide" id="divBigImgUploadProgress">
								<div class="loading-s">
									<img src="STATIC_DOMAIN/img/loading-s.gif">&nbsp;&nbsp;正在上传中...
								</div>
							</div>
							<div class="pic-upload hide" id="divRemoveUploadedBigFile" >图片上传成功，若需删除请<a href="javascript:void(0)" onclick="removeUploadedFileBig()">点此</a>。</div>
							<div class="pic-upload text-red hide" id="divErrorInfoBig"></div>
						</div>
						<div class="input-tips">图片大小120*642像素，支持格式GIF</div>
					</div>
					
            		<!--ThisIsCut-offRule-->
            		<div class="ad-preview">
					
						<div class="ad-area">
							<div class="preview-title"><a id="aCreativeTitle" href="http://www.renren.com" target="_blank" style="text-align:left;outline:none;">加入"人人"网</a></div>
							<a id="aCreativeUrl"  target="_blank" style="text-decoration:none; float:left;outline:none;" href="http://www.renren.com">
								<img class="ad-image" id="imgCreativePic" src="STATIC_DOMAIN/img/example-pic100x75.jpg" />
							</a>
							<p class="preview-content">
								<a id="divCreativeContent" href="http://www.renren.com" target="_blank">人人网，中国最真实、最有效的社交平台，加入人人网，找回老朋友，结交新朋友。</a>
							</p>
							<div class="ad-footer" style="float:left; width:200px">
								<a id="aZanSmall" class="like-ad" href="#like">喜欢</a>
								<span id="selfzanSmall" style="color:#888888; padding:0px 0px 0px 5px">100人</span>
							</div>
                		</div>
						
					</div>
			]]>
	</Content>
	 
	<Content id="1" view="validate">
		<Init>
        	<![CDATA[
					var init = function(data){

						var validateResult = ValidateUtil.newResultPack();
						
                    	if(data) {
                    		data = "["+data+"]";
                    		data = eval('('+data+')');
							var len = data.length;

							for(var i=0; i<len; i++){
							
								var type = data[i].revolutionType;
								
								if(type == "social"){
								
									var title = data[i].title;
									if(!ValidateUtil.isEmpty('title', title, '广告标题不能为空', validateResult) && 
										!ValidateUtil.isTooLong('title', title, 30, '广告标题不能超过30个字符', validateResult) && 
										!ValidateUtil.isTooShort('title', title, 2, '广告标题不能少于2个字符', validateResult) &&
										!ValidateUtil.hasInvalidCharTitle('title', title, '广告标题不能包含非法字符', validateResult)){
										//减少验证信息。
									}

									var mediaUri = data[i].mediaUri;
									if(!ValidateUtil.isEmpty('mediaUri', mediaUri, '广告图片地址为空', validateResult)){}


									var clickUrl = data[i].clickUrl;
									if(!ValidateUtil.isEmpty('clickUrl',clickUrl, '广告链接不能为空', validateResult) && 
										!ValidateUtil.isTooLong('clickUrl', clickUrl, 1024, '广告链接不能超过1024个字符', validateResult) && 
										!ValidateUtil.isNotUrl('clickUrl', makeUrl(clickUrl), '链接地址格式不合法', validateResult)){
										//减少验证信息。
									}



									var content = data[i].content;
									if(!ValidateUtil.isEmpty('content', content, '广告描述不能为空', validateResult) &&
										!ValidateUtil.isTooLong('content', content, 80, '广告描述不能超过40个中文或80个字符', validateResult) &&
										!ValidateUtil.moreBlank('content', content, 5, '广告描述不能多于5个回车字符', validateResult) &&
										!ValidateUtil.hasInvalidChar('content', content, '广告描述不能包含非法字符', validateResult)){
										//减少验证信息。
									}
									
								} else if(type == "edm"){
								
										var adMemberName = data[i].adMemberName;
										if(!ValidateUtil.isEmpty('adMemberName',adMemberName,'广告主名称不能为空',validateResult) && 
											!ValidateUtil.isTooLong('adMemberName',adMemberName,20,'广告主名称不能超过20个字符',validateResult) && !ValidateUtil.hasInvalidCharTitle('adMemberName',adMemberName,'广告主名称不能包含非法字符',validateResult)){}
		
										var adFrom = data[i].adFrom;
										if(!ValidateUtil.isEmpty('adFrom',adFrom,'来自不能为空',validateResult) && 
											!ValidateUtil.isTooLong('adFrom',adFrom,20,'来自不能超过20个字符',validateResult) && 
											!ValidateUtil.hasInvalidCharTitle('adFrom',adFrom,'来自不能包含非法字符',validateResult)){
										}
										var array = [0,1];
										var addLike = data[i].addLike;
										if(ValidateUtil.isContainedInArray('addLike',addLike,array,'添加喜欢按钮数据错误',validateResult)){}
										var addShare = data[i].addShare;
										if(ValidateUtil.isContainedInArray('addShare',addShare,array,'添加分享按钮数据错误',validateResult)){}
										var addComment = data[i].addComment;
										if(ValidateUtil.isContainedInArray('addComment',addComment,array,'添加评论框数据错误',validateResult)){}
										var addPage = data[i].addPage;
										if(ValidateUtil.isContainedInArray('addPage',addPage,array,'添加关注page按钮数据错误',validateResult)){}
								
										if(addPage=="1"){
											var pageID = data[i].pageID;
											var pageName = data[i].pageName;
											var pageUrl = data[i].pageUrl;
											if(!ValidateUtil.isEmpty('pageID',pageID,'公共主页ID不能为空',validateResult) && 
												!ValidateUtil.isTooLong('pageID',pageID,15,'公共主页ID格式错误',validateResult) && 
												!ValidateUtil.isTooShort('pageID',pageID,2,'公共主页ID格式错误',validateResult) &&
												ValidateUtil.isNum('pageID',pageID,'公共主页ID格式错误',validateResult)){
											}
											if(!ValidateUtil.isEmpty('pageName',pageName,'公共主页名称不能为空',validateResult) && 
												!ValidateUtil.isTooLong('pageName',pageName,20,'公共主页名称格式错误',validateResult) && 
												!ValidateUtil.isTooShort('pageName',pageName,2,'公共主页名称格式错误',validateResult)){
												
											}
											if(!ValidateUtil.isEmpty('pageUrl',pageUrl,'公共主页链接不能为空',validateResult) && 
												!ValidateUtil.isTooLong('pageUrl',pageUrl,1024,'公共主页链接不能超过1024个字符',validateResult) && 
												!ValidateUtil.isNotUrl('pageUrl',makeUrl(pageUrl),'公共主页链接不符合格式要求',validateResult)){
											}
										}
								
										var title = data[i].title;
										if(!ValidateUtil.isEmpty('title',title,'标题不能为空',validateResult) && 
											!ValidateUtil.isTooLong('title',title,30,'标题不能超过30个字符',validateResult) && 
											!ValidateUtil.isTooShort('title',title,2,'标题不能少于2个字符',validateResult) &&
											!ValidateUtil.hasInvalidCharTitle('title',title,'标题不能包含非法字符',validateResult)){
										}
										var titleUrl = decodeURIComponent(data[i].titleUrl);
										if(!ValidateUtil.isEmpty('titleUrl',titleUrl,'标题链接不能为空',validateResult) && 
											!ValidateUtil.isTooLong('titleUrl',titleUrl,1024,'标题链接不能超过1024个字符',validateResult) && 
											!ValidateUtil.isNotUrl('titleUrl',makeUrl(titleUrl),'标题链接不符合格式要求',validateResult)){
										}
										var iconUrl = data[i].iconUrl;
										if(!ValidateUtil.isEmpty('iconUrl',iconUrl,'头像不能为空',validateResult)){
										}
										var text = data[i].text;
										if(!ValidateUtil.isEmpty('text',text,'文案不能为空',validateResult) && 
											!ValidateUtil.isTooLong('text',text,200,'文案不能超过200个字符',validateResult) && 
											!ValidateUtil.isTooShort('text',text,2,'文案不能少于2个字符',validateResult) &&
											!ValidateUtil.hasInvalidChar('text',text,'文案不能包含非法字符',validateResult)){
										}
										var textUrl = decodeURIComponent(data[i].textUrl);
										if(!ValidateUtil.isEmpty('textUrl',textUrl,'文案链接不能为空',validateResult) && 
											!ValidateUtil.isTooLong('textUrl',textUrl,1024,'文案链接不能超过1024个字符',validateResult) && 
											!ValidateUtil.isNotUrl('textUrl',makeUrl(textUrl),'文案链接不符合格式要求',validateResult)){
										}
										var picUrl = data[i].picUrl;
										if(!ValidateUtil.isEmpty('picUrl',picUrl,'上传图片不能为空',validateResult)){
										}
										var type = data[i].type;
										if(!ValidateUtil.isEmpty('type',type,'type数据为空',validateResult) &&
											ValidateUtil.equal('type',type,8002,'type数据错误',validateResult)){
										}
										var edmVersion = data[i].edmVersion;
										if(!ValidateUtil.isEmpty('edmVersion',edmVersion,'edmVersion为空',validateResult) &&
											ValidateUtil.equal('edmVersion',edmVersion,2,'edmVersion数据错误',validateResult)){
										}
								
										var time = data[i].time;
										if(!ValidateUtil.isEmpty('time',time,'time为空',validateResult) &&
											ValidateUtil.equal('time',time,'$time','time数据错误',validateResult)){
										}
										var userId = data[i].userId;
										if(!ValidateUtil.isEmpty('userId',userId,'userId为空',validateResult) &&
											ValidateUtil.equal('userId',userId,'$userId','userId数据错误',validateResult)){
										}
										var log = data[i].log;
										if(!ValidateUtil.isEmpty('log',log,'log为空',validateResult) &&
											ValidateUtil.equal('log',log,'$log','log数据错误',validateResult)){
										}
										var url = data[i].url;
										if(!ValidateUtil.isEmpty('url',url,'url为空',validateResult) &&
											ValidateUtil.equal('url',url,'$url','url数据错误',validateResult)){
										}
										var adgroupId = data[i].adgroupId;
										if(!ValidateUtil.isEmpty('adgroupId',adgroupId,'adgroupId数据错误',validateResult)){
										}
										var mc = data[i].mc;
										if(!ValidateUtil.isEmpty('mc',mc,'mc为空',validateResult) &&
											ValidateUtil.equal('mc',mc,'$mc','mc数据错误',validateResult)){
										}
										
								}else if(type == "mobile"){
										//mubile验证  待添加
								}
								
							}//for
                    		
                    	}else{

							validateResult.result = 0;
							if(!validateResult.reason) validateResult.reason={};
							validateResult.reason["data"]="数据为空";
                    	}

                    	return obj2str(validateResult);
					};
			]]>
		</Init>
			<![CDATA[
			]]>
	</Content>

</Module>

