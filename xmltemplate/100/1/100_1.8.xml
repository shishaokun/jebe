<?xml version="1.0" encoding="UTF-8"?>
<Module>
	<Content view="runtime">
		<Init>
			<![CDATA[
			JebeManager.API.Like({
				adId: data.creative_id,
				adparam: data,
				placeholder: '.footer'
			});
			JebeManager.API.Close({
				adId: data.creative_id,
				adparam: data
			});
			]]>
		</Init>
		<![CDATA[
		<style>
		.Widget #ad1000000060 .has-flash:hover a.advert-more,#ad1000000060 .has-flash:hover a.advert-more{top:0px; right:23px}
		.Widget #ad1000000060 .ad-contrainer{border:none}
		#ad1000000065{margin-top:auto;}
		</style>
		<div class="ad-contrainer" style="margin:10px 0; clear:both">
			<h4 class="header" style="margin:0px; border-top:none; padding-bottom:6px">
			<a href="{{click_url}}" target="_blank">{{title}}</a>
			<span class="close-btn"></span>
			</h4>
            <a id="imgClickUrl" href="{{click_url}}" target="_blank">
              <img src="{{media_uri+mediaUri}}" />
            </a>
			<div style="padding:0px; margin:0px; text-align:left; clear:both; width:240px;">
				<div class="footer"></div>
			</div>
		</div>
		]]>
	</Content>
	
	<Content view="setting">
		<Init>
			<![CDATA[
					var init = function(data, query){
                    	setHiddenImageWidthAndHeight(240, 160);
						
						$('#titleEdit').rules('remove');
						$('#titleEdit').rules('add', {required:true, minLengthCC:2, maxLengthCC:24, messages:{required:'请输入广告的标题', minLengthCC:'标题不能少于1个汉字(即2个数字或字母)', maxLengthCC:'您的标题过长，不能超过12个汉字(即24个数字或字母)'}});
						
                    	if(data && data != ''){
                        	//changePrice(100, 75, true);
                        	data = eval('(' + data + ')');
							
							
							query.getElementById("clickUrl").value = data.clickUrl;
							query.getElementById("titleEdit").value = data.title;
							calcTitleInputRemain();
							
													
							
							if(data.mediaUri){
    							query.getElementById("mediaUri").value = data.mediaUri;
    							$("#divRemoveUploadedFile").show();
    							$("#mediaUri").parents(".input-line:eq(0)").removeClass("error");
    							$("#mediaUri").parents(".input-holder:eq(0)").siblings(".input-tips-error").remove();
    							$("#mediaUri").parents(".input-holder:eq(0)").siblings(".input-tips").show();
    							$("#picsize").attr("disabled","disabled");
    							$("#creativePic").hide();
							}
							
							preview(data);
						}
						
						$('#show_place_info').html('首页，日志页，相册页，视频页，好友列表页，游戏页');
						
					}
					
					createData = function(){
                    	var result = {};
						result.title = $('#titleEdit').val();
						result.clickUrl = $('#clickUrl').val();						
						result.mediaUri = $('#mediaUri').val();
                    	$('#widget').val(obj2str(result));
                	}
					
                	preview = function(data){
                    	if(data && typeof(data) == 'string' && data != '')
                        data = eval('(' + data + ')');
						
						
						$('#aCreativeTitle').attr('href', makeUrl(data.clickUrl.replace(/ /g, '')));  
						$('#aCreativeTitle').html(data.title.replace(/ /g, " "));
						
						
						$('#aCreativeUrl').attr('href', makeUrl(data.clickUrl.replace(/ /g, '')));
    					
						
						if(data.mediaUri){
							$('#aCreativeUrl').attr('href', makeUrl(data.clickUrl.replace(/ /g,'')));  
							$('#imgCreativePic').attr('src', geneMediaUrl(data.mediaUri));
						}
						
                	}
					
					
					var geneMediaUrl = function(raw){
    					if(raw)
        					return 'http://jebe.xnimg.cn' + raw.replace('http://jebe.xnimg.cn', '');
    					else
        					return '';
					};

					var makeUrl = function(raw){
    					if(raw)
        					return 'http://' + raw.replace('http://', '');
    					else
        					return '';
					};
					
					
					onEditCreativeTitle = function(){
    					replaceTitleInvalidChar();
    					$("#aCreativeTitle").html($("#titleEdit").val().replace(/ /g, " "));
    					calcTitleInputRemain();
					}

					calcTitleInputRemain = function(){
    					var avail = 24 - $.trim($("#titleEdit").val()).getBytes();
    					avail = avail > 0 ? avail : 0;
    					$("#spTitleRemainWords").text(parseInt(avail/2));
					}
					
					onEditCreativeUrl = function(){
    					var value = $.trim($("#clickUrl").val());
    					if(value && !(value.indexOf("http://") != -1 || value.indexOf("https://") != -1)){
        					value = "http://" + value;
    					}
    					$('#aCreativeTitle,#aCreativeUrl').attr('href', value);
					}

					replaceTitleInvalidChar = function(){
    					var title = $("#titleEdit").val();
    					var reg = new RegExp("[\\r]+", "gm");
    					if (title.search(reg) != -1) {
        					title = title.replace(reg, "");
        					$("#titleEdit").val(title);
    					}
					}
					

					calcContentInputRemain = function(){
    					var avail = 80 - $.trim($("#contentEdit").val()).getBytes();
    					avail = avail > 0 ? avail : 0;
						$("#spContentRemainWords").text(parseInt(avail/2));
					}

									
					<xn:template category="selfhelp" unit="pic240_240" version="1.0.0" part="s_js" params="{width:240,height:160,legalExts:'.jpg,.png',fileSize:20}"/>
					
					
			]]>
		</Init>
			
			<![CDATA[
					<!--<div class="input-line clearfix">
                        <div class="inline-input-holder">
                            <input id="commonAD" name="adType" type="radio" value="0" onclick="adTypeSelect()"/>
                            <label class="check-box-holder" for="commonAD">普通广告</label>
                            <input id="newAD" name="adType" type="radio" value="1" onclick="adTypeSelect()"/>
                            <label class="check-box-holder" for="newAD">新广告</label>
                            <input type="hidden" id="adTypeSelected" />
                        </div>
                    </div>-->
					
					
					<div class="input-line clearfix">
						<div class="input-label">
							<label>链接地址: </label>
						</div>
						<div class="input-holder">
							<input class="input-url" id="clickUrl" name="clickUrl" type="text" value="" onblur="onEditCreativeUrl()" onkeyup="onEditCreativeUrl()" validate="{required:true, maxlength:1024, messages:{required:'请输入链接地址', maxlength:'您的链接过长，不能超过1024个字母'}}" />
						</div>
						<div class="input-tips">比如 http://www.renren.com</div>
					</div>
					<div id= "titleEditDiv" class="input-line clearfix">
						<div class="input-label">
							<label>广告标题: </label>
						</div>
						<div class="input-holder">
							<input class="input-ad-title" id="titleEdit" name="titleEdit" type="text" value="" onblur="onEditCreativeTitle()" onkeyup="onEditCreativeTitle()" validate="{required:true, minLengthCC:2, maxLengthCC:24, messages:{required:'请输入广告的标题', minLengthCC:'标题不能少于1个汉字(即2个数字或字母)', maxLengthCC:'您的标题过长，不能超过12个汉字(即24个数字或字母)'}}" />
						</div>
						<div class="input-tips">您还有<span id="spTitleRemainWords">12</span>个汉字可填</div>
					</div>
					
					
					
					
					
					<div class="input-line clearfix">
						<input type="hidden" name="validateMediaUri" value="true" />
						<div class="input-label">
							<label>图片: </label>
						</div>
						<div class="input-holder">
							<input id="mediaUri" name="mediaUri" type="hidden" value="" validate="{required:true,messages:{required:'请上传广告图片'}}" />
							<input class="ad-upload-button" id="creativePic" name="creativePic" type="file" value="上传" onchange="uploadCreativePic();" size="10" />
							<div class="pic-upload hide" id="divImgUploadProgress">
								<div class="loading-s">
									<img src="STATIC_DOMAIN/img/loading-s.gif" />  正在上传中...
								</div>
							</div>
							<div class="pic-upload hide" id="divRemoveUploadedFile" >图片上传成功，若需删除请<a href="javascript:void(0)" onclick="removeUploadedFile('${width}','${height}')">点此</a>。</div>
							<div class="pic-upload text-red hide" id="divErrorInfo"></div>
						</div>
						<div class="input-tips" id="sizecontent">上传图片尺寸为240*160像素，支持JPG/PNG格式</div>
					</div>

					<div class="input-line clearfix" id="bigPic" style="display:none">
						<div class="input-label">
							<label>大图片: </label>
						</div>
						<div class="input-holder">
							<input id="bigMediaUri" name="bigMediaUri" type="hidden" value="" />
							<input id="gifFrames" name="gifFrames" type="hidden" value="" />
							<input class="ad-upload-button" id="creativePicBig" name="creativePicBig" type="file" value="上传" onchange="uploadGifBig();" size="10">
							<div class="pic-upload hide" id="divBigImgUploadProgress">
								<div class="loading-s">
									<img src="STATIC_DOMAIN/img/loading-s.gif">  正在上传中...
								</div>
							</div>
							<div class="pic-upload hide" id="divRemoveUploadedBigFile" >图片上传成功，若需删除请<a href="javascript:void(0)" onclick="removeUploadedFileBig()">点此</a>。</div>
							<div class="pic-upload text-red hide" id="divErrorInfoBig"></div>
						</div>
						<div class="input-tips">图片大小120*642像素，支持格式GIF</div>
					</div>
					
            		<!--ThisIsCut-offRule-->
            		<div class="ad-preview">
					
						<div class="ad-area" style="width:242px">
							<div class="preview-title"><a id="aCreativeTitle" href="http://www.renren.com" target="_blank" style="text-align:left;outline:none;">加入"人人"网</a></div>
							<a id="aCreativeUrl"  target="_blank" style="text-decoration:none; float:left;outline:none;" href="http://www.renren.com">
								<img class="ad-image" id="imgCreativePic" src="STATIC_DOMAIN/img/widget/pic/240x160.jpg" />
							</a>
							<div class="ad-footer" style="float:left; width:200px">
								<a id="aZanSmall" class="like-ad" href="#like">喜欢</a>
								<span id="selfzanSmall" style="color:#888888; padding:0px 0px 0px 5px">100人</span>
							</div>
                		</div>
						
					</div>
			]]>
	</Content>
	 
	<Content id="1" view="validate">
		<Init>
        	<![CDATA[
					var init = function(data){
                    	if(data) {data = eval('('+data+')')}
						
                    	var validateResult = ValidateUtil.newResultPack();
					
					
						var title = data.title;
						if(!ValidateUtil.isEmpty('title', title, '广告标题不能为空 ', validateResult) && 
							!ValidateUtil.isTooLong('title', title, 30, '广告标题不能超过30个字符', validateResult) && 
							!ValidateUtil.isTooShort('title', title, 2, '广告标题不能少于2个字符', validateResult) &&
							!ValidateUtil.hasInvalidCharTitle('title', title, '广告标题不能包含非法字符', validateResult)){
							//减少验证信息。
						}

						var mediaUri = data.mediaUri;
						if(!ValidateUtil.isEmpty('mediaUri', mediaUri, '广告图片地址为空', validateResult)){}

						var clickUrl = data.clickUrl;
						if(!ValidateUtil.isEmpty('clickUrl',clickUrl, '广告链接不能为空', validateResult) && 
							!ValidateUtil.isTooLong('clickUrl', clickUrl, 1024, '广告链接不能超过1024个字符', validateResult) && 
							!ValidateUtil.isNotUrl('clickUrl', makeUrl(clickUrl), '链接地址格式不合法', validateResult)){
							//减少验证信息。
						}
					
					
                    	return obj2str(validateResult);
					};
			]]>
		</Init>
			<![CDATA[
			]]>
	</Content>

</Module>